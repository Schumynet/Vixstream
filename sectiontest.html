<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Test VixStream – Caroselli & Ricerca</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background: #121212; color: #e5e5e5; }

    /* Nasconde la scrollbar */
    .scrollbar-hide {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
    .scrollbar-hide::-webkit-scrollbar {
      display: none;
    }

    .poster { height: 300px; object-fit: cover; border-radius: 8px; }
    .dropdown-bg { background: #1f1f1f; }
    .carousel-wrapper {
      position: relative;
    }
    .carousel-arrow {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(0,0,0,0.5);
      border: none;
      padding: 0.5rem;
      border-radius: 9999px;
      color: #fff;
      cursor: pointer;
      z-index: 10;
    }
    .carousel-arrow.left { left: 0.5rem; }
    .carousel-arrow.right { right: 0.5rem; }
  </style>
</head>
<body class="p-6">

  <!-- Barra di ricerca compatta -->
  <div class="max-w-4xl mx-auto mb-10 relative">
    <div id="search-bar" class="flex items-center bg-gray-800 rounded-lg px-4 py-2 cursor-text">
      <i class="fas fa-search text-gray-400 mr-2"></i>
      <input
        id="search-title"
        type="text"
        placeholder="Titolo..."
        class="bg-transparent flex-1 placeholder-gray-400 text-white focus:outline-none"
      />
    </div>

    <!-- Tendina filtri -->
    <div
      id="search-dropdown"
      class="absolute inset-x-0 mt-2 p-4 rounded-lg shadow-lg dropdown-bg hidden z-20"
    >
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <div class="md:col-span-2">
          <label class="block text-sm mb-1">Titolo</label>
          <input
            id="filter-title"
            type="text"
            placeholder="Es. Matrix"
            class="w-full px-3 py-2 bg-gray-800 text-white rounded focus:outline-none"
          />
        </div>
        <div>
          <label class="block text-sm mb-1">Anno</label>
          <input
            id="filter-year"
            type="number"
            placeholder="1999"
            class="w-full px-3 py-2 bg-gray-800 text-white rounded focus:outline-none"
          />
        </div>
        <div>
          <label class="block text-sm mb-1">Tipologia</label>
          <select
            id="filter-type"
            class="w-full px-3 py-2 bg-gray-800 text-white rounded focus:outline-none"
          >
            <option value="">Tutti</option>
            <option value="movie">Film</option>
            <option value="tv">Serie TV</option>
          </select>
        </div>
        <div>
          <label class="block text-sm mb-1">Genere</label>
          <select
            id="filter-genre"
            class="w-full px-3 py-2 bg-gray-800 text-white rounded focus:outline-none"
          >
            <option value="">Tutti</option>
          </select>
        </div>
      </div>
      <div class="mt-4 text-right">
        <button
          id="btn-search"
          class="bg-red-600 hover:bg-red-700 text-white px-5 py-2 rounded-lg font-semibold"
        >
          Cerca
        </button>
      </div>
    </div>
  </div>

  <!-- Sezione risultati ricerca -->
  <section id="results-section" class="max-w-6xl mx-auto mb-12 hidden">
    <h2 class="text-2xl font-bold mb-4">🔍 Risultati ricerca</h2>
    <div id="results" class="flex space-x-4 overflow-x-auto scrollbar-hide scroll-smooth"></div>
  </section>

  <!-- Caroselli TMDB -->
  <div class="max-w-6xl mx-auto space-y-16">

<section id="continue-section" class="max-w-6xl mx-auto mt-16 hidden">
  <h2 class="text-2xl font-bold mb-4">📺 Continua a guardare</h2>
  <div id="continue-watch" class="flex space-x-4 overflow-x-auto scrollbar-hide scroll-smooth"></div>
</section>

    <section>
      <h2 class="text-2xl font-bold mb-4">🎬 Film in tendenza</h2>
      <div class="carousel-wrapper">
        <button class="carousel-arrow left" data-target="trending">
          <i class="fas fa-chevron-left"></i>
        </button>
        <div id="trending" class="flex space-x-4 overflow-x-auto scrollbar-hide scroll-smooth"></div>
        <button class="carousel-arrow right" data-target="trending">
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>
    </section>

    <section>
      <h2 class="text-2xl font-bold mb-4">📺 Serie TV popolari</h2>
      <div class="carousel-wrapper">
        <button class="carousel-arrow left" data-target="tv">
          <i class="fas fa-chevron-left"></i>
        </button>
        <div id="tv" class="flex space-x-4 overflow-x-auto scrollbar-hide scroll-smooth"></div>
        <button class="carousel-arrow right" data-target="tv">
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>
    </section>

    <section>
      <h2 class="text-2xl font-bold mb-4">⭐ Film più votati</h2>
      <div class="carousel-wrapper">
        <button class="carousel-arrow left" data-target="top">
          <i class="fas fa-chevron-left"></i>
        </button>
        <div id="top" class="flex space-x-4 overflow-x-auto scrollbar-hide scroll-smooth"></div>
        <button class="carousel-arrow right" data-target="top">
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>
    </section>

    <section>
      <h2 class="text-2xl font-bold mb-4">🎞️ Film al cinema</h2>
      <div class="carousel-wrapper">
        <button class="carousel-arrow left" data-target="upcoming">
          <i class="fas fa-chevron-left"></i>
        </button>
        <div id="upcoming" class="flex space-x-4 overflow-x-auto scrollbar-hide scroll-smooth"></div>
        <button class="carousel-arrow right" data-target="upcoming">
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>
    </section>

    <section>
  <h2 class="text-2xl font-bold mb-4">🎬 Azione</h2>
  <div class="carousel-wrapper">
    <button class="carousel-arrow left" data-target="action">
      <i class="fas fa-chevron-left"></i>
    </button>
    <div id="action" class="flex space-x-4 overflow-x-auto scrollbar-hide scroll-smooth"></div>
    <button class="carousel-arrow right" data-target="action">
      <i class="fas fa-chevron-right"></i>
    </button>
  </div>
</section>

<section>
  <h2 class="text-2xl font-bold mb-4">🗺️ Avventura</h2>
  <div class="carousel-wrapper">
    <button class="carousel-arrow left" data-target="adventure">
      <i class="fas fa-chevron-left"></i>
    </button>
    <div id="adventure" class="flex space-x-4 overflow-x-auto scrollbar-hide scroll-smooth"></div>
    <button class="carousel-arrow right" data-target="adventure">
      <i class="fas fa-chevron-right"></i>
    </button>
  </div>
</section>

<section>
  <h2 class="text-2xl font-bold mb-4">🎨 Animazione</h2>
  <div class="carousel-wrapper">
    <button class="carousel-arrow left" data-target="animation">
      <i class="fas fa-chevron-left"></i>
    </button>
    <div id="animation" class="flex space-x-4 overflow-x-auto scrollbar-hide scroll-smooth"></div>
    <button class="carousel-arrow right" data-target="animation">
      <i class="fas fa-chevron-right"></i>
    </button>
  </div>
</section>

<section>
  <h2 class="text-2xl font-bold mb-4">🔍 Crime</h2>
  <div class="carousel-wrapper">
    <button class="carousel-arrow left" data-target="crime">
      <i class="fas fa-chevron-left"></i>
    </button>
    <div id="crime" class="flex space-x-4 overflow-x-auto scrollbar-hide scroll-smooth"></div>
    <button class="carousel-arrow right" data-target="crime">
      <i class="fas fa-chevron-right"></i>
    </button>
  </div>
</section>

<section>
  <h2 class="text-2xl font-bold mb-4">📚 Documentario</h2>
  <div class="carousel-wrapper">
    <button class="carousel-arrow left" data-target="documentary">
      <i class="fas fa-chevron-left"></i>
    </button>
    <div id="documentary" class="flex space-x-4 overflow-x-auto scrollbar-hide scroll-smooth"></div>
    <button class="carousel-arrow right" data-target="documentary">
      <i class="fas fa-chevron-right"></i>
    </button>
  </div>
</section>

   
    

  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
  <script>
    const API_KEY = '1e8c9083f94c62dd66fb2105cd7b613b';
    const TMDB = 'https://api.themoviedb.org/3';
    const POSTER = 'https://image.tmdb.org/t/p/w500';
    let genreMap = {}, genreList = [];

    function createCard(item, type) {
      const src = item.poster_path
        ? POSTER + item.poster_path
        : item.backdrop_path
          ? POSTER + item.backdrop_path
          : 'https://via.placeholder.com/500x750?text=No+Image';
      const title = type === 'tv' ? item.name : item.title;
      const year = (type === 'tv' ? item.first_air_date : item.release_date || '').split('-')[0] || 'N/A';
      const genres = (item.genre_ids || []).map(id => genreMap[id]).filter(Boolean).join(', ');
      const div = document.createElement('div');
      div.className = 'min-w-[200px]';
      div.innerHTML = `
        <img src="${src}" alt="${title}" class="poster w-full mb-2"/>
        <h3 class="text-sm font-semibold truncate">${title}</h3>
        <p class="text-gray-400 text-xs">${year}</p>
        <p class="text-gray-400 text-xs">${genres}</p>
      `;

div.onclick = () => openModal(item, type);

      return div;
    }

    async function loadSection(path, containerId, type) {
      const res = await fetch(`${TMDB}${path}?api_key=${API_KEY}&language=it-IT`);
      const { results } = await res.json();
      const el = document.getElementById(containerId);
      el.innerHTML = '';
      results.slice(0, 10).forEach(i => el.appendChild(createCard(i, type)));
    }

    async function loadGenres() {
      const [mvRes, tvRes] = await Promise.all([
        fetch(`${TMDB}/genre/movie/list?api_key=${API_KEY}&language=it-IT`),
        fetch(`${TMDB}/genre/tv/list?api_key=${API_KEY}&language=it-IT`)
      ]);
      const mv = await mvRes.json(), tv = await tvRes.json();
      genreList = [...mv.genres, ...tv.genres];
      genreList.forEach(g => genreMap[g.id] = g.name);

      // dropdown generi
      const sel = document.getElementById('filter-genre');
      genreList.forEach(g => {
        const o = document.createElement('option');
        o.value = g.id; o.textContent = g.name;
        sel.appendChild(o);
      });

      // crea caroselli per generi
      const container = document.getElementById('genre-sections');
      genreList.slice(0,6).forEach(g => {
        const section = document.createElement('section');
        section.innerHTML = `
          <h2 class="text-2xl font-bold mb-4">🎭 ${g.name}</h2>
          <div class="carousel-wrapper">
            <button class="carousel-arrow left" data-target="genre-${g.id}">
              <i class="fas fa-chevron-left"></i>
            </button>
            <div id="genre-${g.id}" class="flex space-x-4 overflow-x-auto scrollbar-hide scroll-smooth"></div>
            <button class="carousel-arrow right" data-target="genre-${g.id}">
              <i class="fas fa-chevron-right"></i>
            </button>
          </div>
        `;
        container.appendChild(section);
        loadSection(`/discover/movie?with_genres=${g.id}`, `genre-${g.id}`, 'movie');
      });
    }

    async function doSearch() {
      const q = document.getElementById('filter-title').value.trim();
      const y = document.getElementById('filter-year').value.trim();
      const t = document.getElementById('filter-type').value;
      const g = document.getElementById('filter-genre').value;
      let results = [];

      if (q) {
        const res = await fetch(`${TMDB}/search/multi?api_key=${API_KEY}&language=it-IT&query=${encodeURIComponent(q)}`);
        results = (await res.json()).results;
      } else {
        if (!t || t === 'movie') {
          let url = `${TMDB}/discover/movie?api_key=${API_KEY}&language=it-IT`;
          if (y) url += `&primary_release_year=${y}`;
          if (g) url += `&with_genres=${g}`;
          results.push(...(await fetch(url).then(r => r.json())).results);
        }
        if (!t || t === 'tv') {
          let url = `${TMDB}/discover/tv?api_key=${API_KEY}&language=it-IT`;
          if (y) url += `&first_air_date_year=${y}`;
          if (g) url += `&with_genres=${g}`;
          results.push(...(await fetch(url).then(r => r.json())).results);
        }
      }

      const filtered = results.filter(i => ['movie','tv'].includes(i.media_type || t));
      const box = document.getElementById('results');
      box.innerHTML = '';
      filtered.slice(0, 20).forEach(i => box.appendChild(createCard(i, i.media_type || t || 'movie')));
      document.getElementById('results-section').classList.remove('hidden');
    }

    function initCarousels() {
      document.querySelectorAll('.carousel-arrow').forEach(btn => {
        btn.addEventListener('click', () => {
          const id = btn.getAttribute('data-target');
          const dir = btn.classList.contains('left') ? -1 : 1;
          const container = document.getElementById(id);
          const scrollAmount = container.clientWidth * 0.7;
          container.scrollBy({ left: scrollAmount * dir, behavior: 'smooth' });
        });
      });
    }

    document.addEventListener('DOMContentLoaded', () => {
      // Inizializza dati
      loadGenres();
      loadSection('/trending/movie/week', 'trending', 'movie');
      loadSection('/tv/popular', 'tv', 'tv');
      loadSection('/movie/top_rated', 'top', 'movie');
      loadSection('/movie/upcoming', 'upcoming', 'movie');
      // custom genre carousels
      loadSection('/discover/movie?api_key=' + API_KEY + '&language=it-IT&with_genres=28', 'action', 'movie');        // Azione
      loadSection('/discover/movie?api_key=' + API_KEY + '&language=it-IT&with_genres=12', 'adventure', 'movie');   // Avventura
      loadSection('/discover/movie?api_key=' + API_KEY + '&language=it-IT&with_genres=16', 'animation', 'movie');   // Animazione
      loadSection('/discover/movie?api_key=' + API_KEY + '&language=it-IT&with_genres=80', 'crime', 'movie');       // Crime
      loadSection('/discover/movie?api_key=' + API_KEY + '&language=it-IT&with_genres=99', 'documentary', 'movie'); // Documentario
      



      // Gestione ricerca dropdown
      const bar = document.getElementById('search-bar');
      const dd  = document.getElementById('search-dropdown');
      bar.addEventListener('click', e => {
        e.stopPropagation();
        dd.classList.toggle('hidden');
        document.getElementById('filter-title').focus();
      });
      dd.addEventListener('click', e => e.stopPropagation());
      document.addEventListener('click', () => dd.classList.add('hidden'));
      document.getElementById('btn-search').onclick = doSearch;

      // Inizializza caroselli
      initCarousels();
    });




function openModal(item, type = 'movie') {
  document.getElementById('modal').classList.remove('hidden');
  document.getElementById('modal-title').textContent = type === 'tv' ? item.name : item.title;
  document.getElementById('modal-overview').textContent = item.overview || 'Nessuna descrizione disponibile.';
  document.getElementById('modal-poster').src = item.poster_path
    ? POSTER + item.poster_path
    : 'https://via.placeholder.com/500x750?text=No+Image';

  // Salva l'elemento per uso nei bottoni
  modalItem = item;
  modalType = type;
}

document.getElementById('modal-close').onclick = () => {
  document.getElementById('modal').classList.add('hidden');
};

document.getElementById('btn-back').onclick = () => {
  document.getElementById('modal').classList.add('hidden');
};

document.getElementById('btn-watch').onclick = () => {
  const box = document.getElementById('continue-watch');
  box.appendChild(createCard(modalItem, modalType));
  document.getElementById('continue-section').classList.remove('hidden');
  document.getElementById('modal').classList.add('hidden');
};

document.getElementById('btn-info').onclick = () => {
  alert('Funzione Info in arrivo!');
};

let modalItem = null;
let modalType = 'movie';

  </script>

<div id="modal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 hidden">
  <div class="bg-gray-900 rounded-lg p-6 max-w-md w-full text-white relative">
    <button id="modal-close" class="absolute top-2 right-2 text-gray-400 hover:text-white text-xl">&times;</button>
    <img id="modal-poster" src="" alt="" class="w-full h-64 object-cover rounded mb-4">
    <h2 id="modal-title" class="text-xl font-bold mb-2"></h2>
    <p id="modal-overview" class="text-sm text-gray-300 mb-4"></p>
    <div class="flex justify-between">
      <button id="btn-watch" class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded">Guarda ora</button>
      <button id="btn-info" class="bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded">Info</button>
      <button id="btn-back" class="bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded">Indietro</button>
    </div>
  </div>
</div>


</body>
</html>
